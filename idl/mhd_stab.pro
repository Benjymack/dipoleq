; mhd_stab.pro; make final figures for mhd stability paper@dtgarrow.pro@plot_ldx.pro@get_hdf_data.pro@ldxeq_plot.propro fig3,ps=ps,small=small   if keyword_set(ps) then begin      oldd=!d      oldp=!p      set_plot,'ps'      device,encap=0,preview=0,file="PoP23786L3.ps"      if keyword_set(small) then begin          device,xsize=8.5,ysize=6          device,set_character_size=[10,14]*1000/72.      endif else begin           device,xsize=0,ysize=0           device,set_character_size=0      endelse          ; !p.font=1   endif else if keyword_set(eps) then begin      oldd=!d      set_plot,'ps'      device,file="PoP23786L3.eps"      device,/encap,preview=1      device,xsize=8.5,ysize=5           ; !p.font=1   endif ; else !p.font=-1   openr,lun,/get_lun,"LDX_Beta10_FluxPr.out"   a=''   r=0.   b=0.   p=0.   while strpos(a,"Psi") eq -1 do begin   	readf,lun, a   endwhile      line = {i:0,psix:0.0,psi:0.0,P:0.0,Pp:0.0,V:0.0,Vol:0.0,$    j:0.0, B2:0.0, beta:0.0, betam:0.0,RBm:0.0,zbm:0.0,bbm:0.0}      on_ioerror,done      while 1 do begin       readf,lun,line       r  = [r, line.RBm]       b = [b,line.bbm]       p  = [p, line.p]    endwhile      done: on_ioerror, null      free_lun,lun         p  = p[1:*]   b  = b[1:*]   r  = r[1:*] 	   p = p/1000.    plot,r,p,ystyle=8,xmargin=[6,8],thick=1.5,$     xtitle="Radius (m)",ytitle="Pressure (kPa)"   axis,ystyle=1,yaxis=1,yrange=[0,max(b)],/save,ytitle="Magnetic Field (T)"   oplot,r,b,lines=2,thick=1.5      left = 1.3   top  = .14   sep = .018   len  = .35   adjv = -.0025   adjh = .07      plots,left+[0,len],top*[1,1],/data,thick=1.5   xyouts,/data,left+len+adjh,top+adjv,"Pressure"   top = top-sep   plots,left+[0,len],top*[1,1],/data,lines=2,thick=1.5   xyouts,/data,left+len+adjh,top+adjv,"Magnetic Field"   plots,/data,[.8125,.8125],!y.crange,lines=1   xyouts,/data,1.35,.09, "!4b!X!Dmax!N = 5.5 radius"   dtgarrow,/solid,hangle=15,/data,1.32,.092,.8125,.125    if keyword_set(ps) or keyword_set(eps) then begin       device,/close       set_plot,oldd.name   endifendpro read_dibal_dat,file,r,z,s,x,xp	   openr,lun,/get_lun,file   a=''   r=0.   z=0.   s=0.   x=0.   while strpos(a,"X'") eq -1 do begin   	readf,lun, a   endwhile   xp=1.0   readf,lun,xp      while strpos(a,"kappa_psi") eq -1 do begin   	readf,lun, a   endwhile      line = {R:0.0,Z:0.0,kpsi:0.0,S:0.0,X:0.0}      on_ioerror,done      while 1 do begin       readf,lun,line       r  = [r, line.R]       z  = [z, line.Z]       s  = [s, line.S]       x  = [x, line.X]    endwhile      done: on_ioerror, null      free_lun,lun   r = r[1:*]      z = z[1:*]      s = s[1:*]      x = x[1:*]end   pro fig4, ps=ps, small=small   common fig4_common,re1,ze1,se1,xe1,ro1,zo1,so1,xo1,xpo1,ro2,zo2,so2,xo2,xpo2,$   				 beta, rbeta, zbeta      if keyword_set(ps) then begin      oldd=!d      set_plot,'ps'      device,file="PoP23786L4.ps"     ; !p.font=1      if keyword_set(small) then begin          device,xsize=8.5,ysize=6          device,set_character_size=[10,14]*1000/72.      endif else begin           device,xsize=0,ysize=0           device,set_character_size=0      endelse   endif ; else !p.font=-1      if not keyword_set(beta) then begin	  read_dibal_dat,"even.dat",re1,ze1,se1,xe1  	  read_dibal_dat,"odd1.dat",ro1,zo1,so1,xo1,xpo1  	  read_dibal_dat,"odd2.dat",ro2,zo2,so2,xo2,xpo2         get_hdf_data,"LDX_Beta10.HDF","Beta",beta,rbeta,zbeta   endif      xe = xe1/max([max(xe1),-min(xe1)])   centr = (max(re1)+min(re1))/2.0   thete = atan(ze1,re1-centr)   sortie = sort(thete)   thete = thete(sortie)   xe = xe(sortie)        gam = (1-xpo2)/(xpo1-xpo2)   xo = gam*xo1 + (1-gam)*xo2   ro = gam*ro1 + (1-gam)*ro2   zo = gam*zo1 + (1-gam)*zo2         theto = atan(zo,ro-centr)   sorti = sort(theto)   theto = theto(sorti)   xo = xo(sorti)   xo = xo/max([max(xo),-min(xo)])      ire = interpol(indgen(n_elements(rbeta)),rbeta,re1)   jze = interpol(indgen(n_elements(zbeta)),zbeta,ze1)   betae = interpolate(beta,ire,jze,cubic=-.5)   betae = betae(sortie)      plot,thete,xe,yrange = [-1.1,1.1],ystyle=9,xmargin=[8,6],thick=1.5,$      xtitle="Poloidal Angle (radians)", $      ytitle = "Eigenmode Amplitude (a.u.)", $      xticks=4 , xtickv=[-!pi,-!pi/2,0.0,!pi/2,!pi], $      xtickname=['-!4p!X','-!4p!X/2',"Outer Midplane",'!4p!X/2','!4p!X']         oplot,theto,xo,lines=2,thick=1.5   axis,yaxis=1,ytitle="Local !4b!X",yrange=[0,6],/save   oplot,thete,betae,lines=1,thick=1.5      left = -!pi*.9   top  = 5.5   sep  = .4   len  = .7   adjv = -.07   adjh = .1      plots,left+[0,len],top*[1,1],/data,thick=1.5   xyouts,/data,left+len+adjh,top+adjv,"Even e-mode"   top = top-sep   plots,left+[0,len],top*[1,1],/data,lines=2,thick=1.5   xyouts,/data,left+len+adjh,top+adjv,"Odd  e-mode"   top = top-sep   plots,left+[0,len],top*[1,1],/data,lines=1,thick=1.5   xyouts,/data,left+len+adjh,top+adjv,"!4b!X"       if keyword_set(ps) then begin       device,/close       set_plot,oldd.name   endif   print,"Maximum Beta = ",max(betae)endpro mhd_stab,ps = ps, small=small   if keyword_set(ps) then begin      oldd=!d      set_plot,'ps'      device,file="PoP23786L1.ps"     ; !p.font=1      if keyword_set(small) then begin          device,xsize=8.5,ysize=9          device,set_character_size=[10,14]*1000/72.      endif else begin           device,xsize=0,ysize=0           device,set_character_size=0      endelse   endif ; else !p.font=-1!x.margin = [8,1]ldxeq_plot, "LDX_Vac.HDF"xyouts,/data,1.32,1.28,"X-Point"dtgarrow,/solid,hangle=15, /data, 1.3,1.3,1,1.21xyouts,/data,1.93,1.15,"Vacuum Vessel"dtgarrow,/solid,hangle=15,/data, 2.35322,      1.09076,  2.32485,     0.849580xyouts,/data,.12,.88,"Levitation Coil"dtgarrow,/solid,hangle=15,/data, .3,.98,.5,1.49xyouts,/data,.12,-.79,"Floating Ring"dtgarrow,/solid,hangle=15,/data,.3,-.7,.45,-.08   if keyword_set(ps) then begin   	  device,/close   	  device,file="PoP23786L2.ps"   endif else begin         char='a'      read,char   endelseldxeq_plot, "LDX_Beta10.HDF",hi=-.4825   ; beta=5.43 surface from _FluxPr.outxyouts,/data,.6,-.87,"!4b!X!Dmax!N = 5.5 surface"dtgarrow,/solid,hangle=15,/data, 0.70, -0.769167, 0.78, -0.106285xyouts,/data,1.98,1.15,"plasma!C   limited"dtgarrow,/solid,hangle=15,/data, 2.28, 1.02, 2.46, 0.44  if keyword_set(ps) then begin       device,/close       set_plot,oldd.name   endif!x.margin = 0end